#######
使用文档
#######

.. Contents :: 目录

Purge 权限申请
==============

目前 APIKey 的申请已经迁移到 Portal 工单中, 通过流程申请, 具体申请链接如下:

https://portal.qiyi.domain/process/interface/BsiList

API 使用
========

创建Purge请求
------------

**接口参数**

+--------------+--------+-----------------------------+
| 参数         | 类型   | 含义                        |
+==============+========+=============================+
| uri          | string | 需要刷新的静态资源的完整url |
+--------------+--------+-----------------------------+
| api_key      | string | 用户注册申请的api key       |
+--------------+--------+-----------------------------+
| callback_url | string | 回调 url(可选)              |
+--------------+--------+-----------------------------+
| taskId       | string | 任务 id(可选)               |
+--------------+--------+-----------------------------+

**请求实例**

::

   GET http://purge-api.qiyi.domain/api/purge?uri=http://www.iqiyi.com/hello.gif&api_key=BsZzuSHlwCl8jCupocGDHOpg8kXFGk73NR1GLU9OnKw
   {
       "create_at": "20170504172753",
       "status": "created",
       "uri": "http://www.iqiyi.com/hello.gif"
    }



**返回结果**


+-----------+--------+---------------------+
| 参数      | 类型   | 含义                |
+===========+========+=====================+
| status    | string |  返回结果的状态     |
+-----------+--------+---------------------+
| create_at | string | purge任务创建的时间 |
+-----------+--------+---------------------+


查询Purge结果
------------

**接口参数**


+-----------+--------+---------------------------------------------------+
| 参数      | 类型   | 含义                                              |
+===========+========+===================================================+
| status    | string |  已创建(created),创建失败(failed),执行中(running) |
+-----------+--------+---------------------------------------------------+
| create_at | string | 创建时间字符串                                    |
+-----------+--------+---------------------------------------------------+

**请求实例**


::

   GET http://purge-api.qiyi.domain/api/q?uri=http://www.iqiyi.com/hello.gif&api_key=BsZzuSHlwCl8jCupocGDHOpg8kXFGk73NR1GLU9OnKw 
   {
       "create_at": "20170504172753",
       "failed": 9, 
       "failed_ips": [
            "58.30.207.78",
            "58.30.207.79",
            "112.5.254.164",
            "113.215.7.22",
            "112.5.254.168",
            "58.30.207.81",
            "58.30.207.80",
            "113.215.7.23",
            "113.215.7.24"
      ],
      "finish_at": "20170504172754",
      "start_at": "20170504172753",
      "status": "failed",
      "success": 292,
      "success_ips": [
            "10.221.32.216",
            "10.221.32.215",
            "10.10.135.208",
            "10.24.44.71",
            "10.93.103.3",
            "10.57.171.64",
            "10.20.190.1",
            "10.23.70.96",
            "10.153.56.162",
            "10.221.32.94",
            "10.27.70.218",
            "10.25.50.201",
            "10.20.178.39",
            "10.71.0.19",
            "10.93.103.4",
            "10.20.190.5",
            "10.121.34.64",
            "10.121.34.61",
            "10.20.184.33",
            "10.53.10.76",
            "10.37.60.2",
            "10.25.159.68",
            "10.71.0.13",
            "10.37.66.156",
            "10.20.178.44"
      ],
      "total": 301,
      "uri": "http://www.iqiyi.com/hello.gif"
   }

**返回结果**

+---------------+---------------------+------------------------------------------------------------+
| 参数          | 类型                | 含义                                                       |
+===============+=====================+============================================================+
| url           | string              | 需要刷新的静态资源的完整 url                               |
+---------------+---------------------+------------------------------------------------------------+
| status        | string              | 已创建(created),成功(success),失败(failed),执行中(running) |
+---------------+---------------------+------------------------------------------------------------+
| create_at     | string              | 任务创建时间                                               |
+---------------+---------------------+------------------------------------------------------------+
| finish_at     | string              | 任务完成时间                                               |
+---------------+---------------------+------------------------------------------------------------+
| start_at      | string              | 任务开始时间                                               |
+---------------+---------------------+------------------------------------------------------------+
| total         | int                 | 总IP数                                                     |
+---------------+---------------------+------------------------------------------------------------+
| success       | int                 | 成功IP数                                                   |
+---------------+---------------------+------------------------------------------------------------+
| failed        | int                 | 失败IP数                                                   |
+---------------+---------------------+------------------------------------------------------------+
| success_ips   | []string            | 成功IP列表                                                 |
+---------------+---------------------+------------------------------------------------------------+
| failed_ips    | []string            | 失败IP列表                                                 |
+---------------+---------------------+------------------------------------------------------------+
| failed_status | map[string][]string | 不同失败状态对应的失败IP列表                               |
+---------------+---------------------+------------------------------------------------------------+


